<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>EditableGrid</title>
		
		<script src="lib/editablegrid.js"></script>
		<script src="lib/editablegrid_renderers.js" ></script>
		<script src="lib/editablegrid_editors.js" ></script>
		<script src="lib/editablegrid_validators.js" ></script>
		<script src="lib/editablegrid_utils.js" ></script>
		<script src="lib/editablegrid_charts.js" ></script>
		<script src="jquery/jquery-1.6.4.min.js" ></script>
		<script src="jquery/jquery-ui-1.8.16.custom.min.js" ></script>

		<link href="http://fonts.googleapis.com/css?family=Ubuntu:300,400,700" rel="stylesheet" type="text/css">
		<link href="css/editablegrid.css" rel="stylesheet" type="text/css">
		<link href="css/normalize.css" rel="stylesheet" type="text/css">
		<!-- <link href="css/responsive.css" rel="stylesheet" type="text/css"> -->
		<!-- <link href="css/style.css" rel="stylesheet" type="text/css"> -->
		<link href="css/font-awesome.css" rel="stylesheet" type="text/css">
		<link rel="stylesheet" href="style.css" type="text/css" media="screen">
		
		<style>
			body { font-family:'lucida grande', tahoma, verdana, arial, sans-serif; font-size:11px; }
			h1 { font-size: 15px; }
			a { color: black; text-decoration: none; font-weight: 100}
			a:hover { text-decoration: underline; }
			#plc {
				display: grid;
				/*justify-content: center;*/
			}
			.editablegrid-subgroup_id, .editablegrid-_id, .editablegrid-subgroup_name {
				display: none;
			}
			th { text-align: center; padding:5px 10px;}
			table { border-radius: 10px;}
			table.plc, table.math { border-collapse: collapse; border: 1px solid #CCB; width: auto; font-size: 15px;}
			table.plc td, table.math td{ padding: 5px;  font-size: 15px; border: 1px solid #403b3b29; width:50px; height: 33px;}
			table.plc th, table.math th { background: #E5E5E5; text-align: left; font-size: 16px; height: 40px; color:black !important; }
			td:nth-child(even), td:nth-child(even) {background: #eeeeee}
			td:nth-child(odd),  td:nth-child(odd) {background: #FFF}
			input.invalid { background: red; color: #FDFDFD; }
			/*tabletr:hover {background: #FFF !important; }	*/

		</style>
		
		<script>
			var editableGrid;
			var mathGrid;
			window.onload = function() {
				var result = getJSON("https://api.autobits.in/api/subgroups/2/tags-new").then(res => {
					var plc = [];
					var data = [];
					res.forEach((item, index) => {
						if (index === 0) {
							// for (var field in item) {
								// plc.push({ 
								// 	name: field,
								// 	label: field.toUpperCase(),
								// 	datatype: "string",
								// 	editable: (field == "address" 
								// 			) 
								// 		? false : true,
								// })
								plc.push({ name: '_id', label: 'TagId', datatype: "string", editable: true })
								plc.push({ name: 'subgroup_id', label: 'Subgroup Id', datatype: "string", editable: true })
								plc.push({ name: 'subgroup_name', label: 'Subgroup name', datatype: "string", editable: true })
								plc.push({ name: 'subgroup_type', label: 'Subgroup type', datatype: "string", editable: true })
								plc.push({ name: 'name', label: 'Name', datatype: "string", editable: true })
								plc.push({ name: 'address', label: 'Address', datatype: "string", editable: false })
								plc.push({ name: 'data_type', label: 'Data type', datatype: "string", editable: true })
								plc.push({ name: 'base_unit', label: 'Base unit', datatype: "string", editable: true })
								plc.push({ name: 'interval', label: 'Interval', datatype: "string", editable: true })
								plc.push({ name: 'writable', label: 'Writable', datatype: "string", editable: true })
								plc.push({ name: 'fixed_float', label: 'Fixed_float', datatype: "string", editable: true })
								plc.push({ name: 'offset_method', label: 'Offset_method', datatype: "string", editable: true })
								plc.push({ name: 'offset_tag', label: 'Offset_tag', datatype: "string", editable: true })
								plc.push({ name: 'offset_type', label: 'Offset_type', datatype: "string", editable: true })
								plc.push({ name: 'offset_value', label: 'Offset_value', datatype: "string", editable: true })
								plc.push({ name: 'reduce_data', label: 'Reduce_data', datatype: "string", editable: true })
								plc.push({ name: 'reduce_type', label: 'Reduce_type', datatype: "string", editable: true })
								plc.push({ name: 'reset', label: 'Reset', datatype: "string", editable: true })
							// }	
						}
						data.push({
							No: index + 1,
							values:	{
								_id: item._id, // 0
								subgroup_id: item.subgroup_id,
								subgroup_name: item.subgroup_name,
								subgroup_type: item.subgroup_type,
								name: item.name, // 1
								address: item.address, // 2
								data_type: item.data_type, // 4
								base_unit: item.base_unit, // 3
								interval: item.interval, // 3
								writable: item.writable, //14
								fixed_float: item.fixed_float, //5
								offset_method: item.offset_method, //6
								offset_tag: item.offset_tag, //7
								offset_type: item.offset_type, // 8
								offset_value: item.offset_value, // 9 
								reduce_data: item.reduce_data, // 10
								reduce_type: item.reduce_type, // 11
								reset: item.reset, // 12
							}	
						})
					})
					plc[6].values = {};
					plc[7].values = {};
					plc[9].values = {};
					plc[10].values = {};
					plc[11].values = {};
					plc[12].values = {};
					plc[13].values = {};	
					plc[14].values = {};
					plc[16].values = {};
					plc[17].values = {};

					plc[6].values["data_type"] = {"boolean": "boolean", "modbus": "modbus"};
					plc[7].values["base_unit"] = {"kg": "kg", "": "base_unit"};
					plc[9].values["writable"] = {"true": "TRUE", "false": "FALSE"};
					plc[10].values["fixed_float"] = {"":"0","1":"1","2": "2","3": "3","4": "4"};
					plc[11].values["offset_method"] = {"": "None","divide": "Divide", "multiply": "Multiply", "add": "Add", "subract": "Subract"};
					plc[12].values["offset_tag"] = {"": "Enable"};
					plc[13].values["offset_type"] = {"": "None", "static":"Static", "type": "By Tag"};
					plc[14].values["offset_value"] = {"": "Enable"};
					plc[16].values["reduce_type"] = {"absoulte": "Absolute", "fixed": "Fixed", "percent": "Percent", "": "None"};
					plc[17].values["reset"] = {"true": "TRUE", "false": "FALSE"};

					editableGrid = new EditableGrid("DemoGridJsData", {
						enableSort: true, // true is the default, set it to false if you don't want sorting to be enabled
						editmode: "absolute", // change this to "fixed" to test out editorzone, and to "static" to get the old-school mode
						editorzoneid: "edition", // will be used only if editmode is set to "fixed"
						pageSize: 10,
						maxBars: 10,
					});

					editableGrid.load({"metadata": plc, "data": data});
					editableGrid.renderGrid("plc", "plc");
					editableGrid.updatePaginator();
					
					
				});
			}

			const filter = () => {
				const filterStr = document.querySelector('#filter').value;
				editableGrid.filter(filterStr, undefined);
			}
		

			const getJSON = url => {
				return new Promise((resolve, reject) => {
					var ajaxRequest = new XMLHttpRequest();
					ajaxRequest.onreadystatechange = function () {
						if (this.readyState == 4 && this.status == 200) {
							resolve(JSON.parse(this.responseText));
						} 
					};

					ajaxRequest.open("GET", url, true);
					ajaxRequest.send("");
				})
			}

			EditableGrid.prototype.initializeGrid = function() 
			{
				with (this) {
					$("#pagesize").val(pageSize).change(function() { editableGrid.setPageSize($("#pagesize").val()); });
				}
			};

			EditableGrid.prototype.updatePaginator = function()
			{
				var paginator = $("#paginator").empty();
				var nbPages = this.getPageCount();

				// get interval
				var interval = this.getSlidingPageInterval(20);
				// var interval = 20;
				if (interval == null) return;
				
				//get pages in interval (with links except for the current page)
				var pages = this.getPagesInInterval(interval, function(pageIndex, isCurrent) {
					if (isCurrent) return "" + (pageIndex + 1);
					return $("<a>").css("cursor", "pointer").html(pageIndex + 1).click(function(event) { editableGrid.setPageIndex(parseInt($(this).html()) - 1); });
				});
					
				// "first" link
				var link = $("<a>").html("<i class='fa fa-fast-backward'></i>");
				if (!this.canGoBack()) link.css({ opacity : 0.4, filter: "alpha(opacity=40)" });
				else link.css("cursor", "pointer").click(function(event) { editableGrid.firstPage(); });
				paginator.append(link);

				// "prev" link
				link = $("<a>").html("<i class='fa fa-backward'></i>");
				if (!this.canGoBack()) link.css({ opacity : 0.4, filter: "alpha(opacity=40)" });
				else link.css("cursor", "pointer").click(function(event) { editableGrid.prevPage(); });
				paginator.append(link);

				// pages
				for (p = 0; p < pages.length; p++) paginator.append(pages[p]).append(" | ");
				
				// "next" link
				link = $("<a>").html("<i class='fa fa-forward'></i>");
				if (!this.canGoForward()) link.css({ opacity : 0.4, filter: "alpha(opacity=40)" });
				else link.css("cursor", "pointer").click(function(event) { editableGrid.nextPage(); });
				paginator.append(link);

				// "last" link
				link = $("<a>").html("<i class='fa fa-fast-forward'></i>");
				if (!this.canGoForward()) link.css({ opacity : 0.4, filter: "alpha(opacity=40)" });
				else link.css("cursor", "pointer").click(function(event) { editableGrid.lastPage(); });
				paginator.append(link);
			};
		</script>
		
	</head>
	
	<body>
	<div id="pagecontrol">
		<label for="pagecontrol">Rows per page: </label>
		<select id="pagesize" name="pagesize">
			<option value="5">5</option>
			<option value="10">10</option>
			<option value="15">15</option>
			<option value="20">20</option>
			<option value="25">25</option>
			<option value="30">30</option>
			<option value="40">40</option>
			<option value="50">50</option>
		</select>

		<!-- Grid filter -->
		<label for="filter">Filter :</label>
		<input type="text" id="filter" onkeyup="filter()">
	</div>
		<div id="plc"></div>
		<div id="paginator" onclick="editableGrid.updatePaginator()"></div>
		<div id="math" align="center" style="margin-top: 20px;"></div>
	</body>

</html>
