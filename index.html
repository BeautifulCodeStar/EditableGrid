<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>EditableGrid - Minimal demo - Creating grid in Javascript</title>
		
		<script src="lib/editablegrid.js"></script>
		<!-- [DO NOT DEPLOY] --> <script src="lib/editablegrid_renderers.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="lib/editablegrid_editors.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="lib/editablegrid_validators.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="lib/editablegrid_utils.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="lib/editablegrid_charts.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="jquery/jquery-1.6.4.min.js" ></script>
		<!-- [DO NOT DEPLOY] --> <script src="jquery/jquery-ui-1.8.16.custom.min.js" ></script>

		<link rel="stylesheet" href="../../editablegrid.css" type="text/css" media="screen">
		<link rel="stylesheet" href="/style.css" type="text/css" media="screen">
		
		<style>
			body { font-family:'lucida grande', tahoma, verdana, arial, sans-serif; font-size:11px; }
			h1 { font-size: 15px; }
			a { color: #548dc4; text-decoration: none; }
			a:hover { text-decoration: underline; }
			#plc {
				display: flex;
				justify-content: center;
			}
			table.plc, table. { border-collapse: collapse; border: 1px solid #CCB; width: auto; font-size: 15px;}
			table.plc td, table.testgrid th { padding: 5px; border: 1px solid #E0E0E0; }
			table.plc th { background: #E5E5E5; text-align: left; font-size: 20px; }
			input.invalid { background: red; color: #FDFDFD; }
		</style>
		
		<script>
			var editableGrid;
			window.onload = function() {
				// this approach is interesting if you need to dynamically create data in Javascript 
				// var metadata = [];
				// metadata.push({ name: "name", label: "NAME", datatype: "string", editable: true});
				// metadata.push({ name: "firstname", label:"FIRSTNAME", datatype: "string", editable: true});
				// metadata.push({ name: "age", label: "AGE", datatype: "integer", editable: true});
				// metadata.push({ name: "height", label: "HEIGHT", datatype: "double(m,2)", editable: true});
				// metadata.push({ name: "country", label: "COUNTRY", datatype: "string", editable: true});
				// metadata.push({ name: "email", label: "EMAIL", datatype: "email", editable: true});
				// metadata.push({ name: "freelance", label: "FREELANCE", datatype: "boolean", editable: true});
				// metadata.push({ name: "lastvisit", label: "LAST VISIT", datatype: "date", editable: true});

				// // a small example of how you can manipulate the object in javascript
				// metadata[4].values = {};
				// metadata[4].values["Europe"] = {"be":"Belgium","fr":"France","uk":"Great-Britain","nl":"Nederland"};
				// metadata[4].values["America"] = {"br":"Brazil","ca":"Canada","us":"USA"};
				// metadata[4].values["Africa"] = {"ng":"Nigeria","za":"South-Africa","zw":"Zimbabwe"};

				// var data = [];
				// data.push({id: 1, values: {"country":"uk","age":33,"name":"Duke","firstname":"Patience","height":1.842,"email":"patience.duke@gmail.com","lastvisit":"11\/12\/2002"}});
				// data.push({id: 2, values: ["Rogers","Denise",59,1.627,"us","rogers.d@gmail.com","","07\/05\/2003"]});
				// data.push({id: 3, values: {"name":"Dujardin","firstname":"Antoine","age":21,"height":1.73,"country":"fr","email":"felix.compton@yahoo.fr","freelance":true,"lastvisit":"21\/02\/1999"}});
				// data.push({id: 4, values: {"name":"Conway","firstname":"Coby","age":47,"height":1.96,"country":"za","email":"coby@conwayinc.com","freelance":true,"lastvisit":"01\/12\/2007"}});
				// data.push({id: 5, values: {"name":"Shannon","firstname":"Rana","age":24,"height":1.56,"country":"nl","email":"ranna.shannon@hotmail.com","freelance":false,"lastvisit":"07\/10\/2009"}});
				// data.push({id: 6, values: {"name":"Benton","firstname":"Jasmine","age":61,"height":1.71,"country":"ca","email":"jasmine.benton@yahoo.com","freelance":false,"lastvisit":"13\/01\/2009"}});
				// data.push({id: 7, values: {"name":"Belletoise","firstname":"André","age":31,"height":1.84,"country":"be","email":"belletoise@kiloutou.be","freelance":true,"lastvisit":""}});
				// data.push({id: 8, values: {"name":"Santa-Maria","firstname":"Martin","age":37,"height":1.80,"country":"br","email":"martin.sm@gmail.com","freelance":false,"lastvisit":"12\/06\/1995"}});
				// data.push({id: 9, values: {"name":"Dieumerci","firstname":"Amédé","age":37,"height":1.81,"country":"ng","email":"dieumerci@gmail.com","freelance":true,"lastvisit":"05\/07\/2009"}});
				// data.push({id: 10,values: {"name":"Morin","firstname":"Wanthus","age":46,"height":1.77,"country":"zw","email":"morin.x@yahoo.jsdata.com","freelance":false,"lastvisit":"04\/03\/2004"}});
		         
				// editableGrid = new EditableGrid("DemoGridJsData");
				// editableGrid.load({"metadata": metadata, "data": data});
				// editableGrid.renderGrid("tablecontent", "testgrid");

				var result = getJSON("https://api.autobits.in/api/subgroups/2/tags-new").then(res => {
					var plc = [];
					var data = [];
					res.forEach((item, index) => {
						if (index === 0) {
							for (var field in item) {
								plc.push({ 
									name: field,
									label: field.toUpperCase(),
									datatype: "string",
									editable: 
										(
											field=="address" 
											// || field=="data_type"
										) 
										? false:true})
							}	
						}
						data.push({
							_id: item._id,
							values:	{
								_id: index + 1, // 0
								name: item.name, // 1
								address: item.address, // 2
								base_unit: item.base_unit, // 3
								data_type: item.data_type, // 4
								fixed_float: item.fixed_float, //5
								offset_method: item.offset_method, //6
								offset_tag: item.offset_tag, //7
								offset_type: item.offset_type, // 8
								offset_value: item.offset_value, // 9 
								reduce_data: item.reduce_data, // 10
								reduce_type: item.reduce_type, // 11
								reset: item.reset, // 12
								script: item.script, //13
								writable: item.writable, //14
							}	
						})
					})
					plc[4].values = {};
					plc[5].values = {};
					plc[6].values = {};
					plc[7].values = {};
					plc[8].values = {};
					plc[9].values = {};
					plc[10].values = {};
					plc[11].values = {};
					plc[12].values = {};
					plc[13].values = {};

					plc[4].values["data_type"] = {"boolean": "boolean", "modbus": "modbus"};
					plc[5].values["base_unit"] = {"kg": "kg", "": "base_unit"};
					plc[6].values["writable"] = {"true": "TRUE", "false": "FALSE"};
					plc[7].values["fixed_float"] = {"1":"1","2": "2","3": "3","4": "4"};
					plc[8].values["reset"] = {"true": "TRUE", "false": "FALSE"};
					plc[9].values["offset_type"] = {"": "None", "static":"Static", "type": "By Tag"};
					plc[10].values["offset_method"] = {"divide": "Divide", "multiply": "Multiply", "add": "Add", "subract": "Subract"};
					plc[11].values["offset_value"] = {"": "Enable"};
					plc[12].values["offset_tag"] = {"": "Enable"};
					plc[13].values["reduce_type"] = {"absoulte": "Absolute", "fixed": "Fixed", "percent": "Percent", "": "None"};

					editableGrid = new EditableGrid("DemoGridJsData", {
						enableSort: true, // true is the default, set it to false if you don't want sorting to be enabled
						editmode: "absolute", // change this to "fixed" to test out editorzone, and to "static" to get the old-school mode
						editorzoneid: "edition", // will be used only if editmode is set to "fixed"
						pageSize: 10,
						maxBars: 10
					});
					editableGrid.load({"metadata": plc, "data": data});
					editableGrid.renderGrid("plc", "plc");
				});
			}


			const getJSON = url => {
				return new Promise((resolve, reject) => {
					var ajaxRequest = new XMLHttpRequest();
					ajaxRequest.onreadystatechange = function () {
						if (this.readyState == 4 && this.status == 200) {
							resolve(JSON.parse(this.responseText));
						} 
					};

					ajaxRequest.open("GET", url, true);
					ajaxRequest.send("");
				})
			}

			EditableGrid.prototype.initializeGrid = function() 
			{
				with (this) {
					$("#pagesize").val(pageSize).change(function() { editableGrid.setPageSize($("#pagesize").val()); });
					// $("#barcount").val(maxBars).change(function() { editableGrid.maxBars = $("#barcount").val(); /*editableGrid.renderCharts(); */ });
				}
			};

			EditableGrid.prototype.updatePaginator = function()
			{
				var paginator = $("#paginator").empty();
				var nbPages = this.getPageCount();

				// get interval
				var interval = this.getSlidingPageInterval(20);
				if (interval == null) return;
				
				// get pages in interval (with links except for the current page)
				// var pages = this.getPagesInInterval(interval, function(pageIndex, isCurrent) {
				// 	if (isCurrent) return "" + (pageIndex + 1);
				// 	return $("<a>").css("cursor", "pointer").html(pageIndex + 1).click(function(event) { editableGrid.setPageIndex(parseInt($(this).html()) - 1); });
				// });
					
				// // "first" link
				// var link = $("<a>").html("<i class='fa fa-fast-backward'></i>");
				// if (!this.canGoBack()) link.css({ opacity : 0.4, filter: "alpha(opacity=40)" });
				// else link.css("cursor", "pointer").click(function(event) { editableGrid.firstPage(); });
				// paginator.append(link);

				// // "prev" link
				// link = $("<a>").html("<i class='fa fa-backward'></i>");
				// if (!this.canGoBack()) link.css({ opacity : 0.4, filter: "alpha(opacity=40)" });
				// else link.css("cursor", "pointer").click(function(event) { editableGrid.prevPage(); });
				// paginator.append(link);

				// // pages
				// for (p = 0; p < pages.length; p++) paginator.append(pages[p]).append(" | ");
				
				// // "next" link
				// link = $("<a>").html("<i class='fa fa-forward'></i>");
				// if (!this.canGoForward()) link.css({ opacity : 0.4, filter: "alpha(opacity=40)" });
				// else link.css("cursor", "pointer").click(function(event) { editableGrid.nextPage(); });
				// paginator.append(link);

				// // "last" link
				// link = $("<a>").html("<i class='fa fa-fast-forward'></i>");
				// if (!this.canGoForward()) link.css({ opacity : 0.4, filter: "alpha(opacity=40)" });
				// else link.css("cursor", "pointer").click(function(event) { editableGrid.lastPage(); });
				// paginator.append(link);
			};
		</script>
		
	</head>
	
	<body>
	<div id="pagecontrol">
		<label for="pagecontrol">Rows per page: </label>
		<select id="pagesize" name="pagesize">
			<option value="5">5</option>
			<option value="10">10</option>
			<option value="15">15</option>
			<option value="20">20</option>
			<option value="25">25</option>
			<option value="30">30</option>
			<option value="40">40</option>
			<option value="50">50</option>
		</select>

		<!-- Grid filter -->
		<label for="filter">Filter :</label>
		<input type="text" id="filter">
	</div>
		<div id="plc"></div>
				
		<div id="tablecontent"></div>
	</body>

</html>
